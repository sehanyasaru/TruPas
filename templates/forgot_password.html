<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forgot Password</title>
  <link rel="stylesheet" href="/static/css/notification.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes scaleUp {
      from { transform: scale(1); }
      to { transform: scale(1.1); }
    }
    @keyframes slideIn {
      from { transform: translate(-50%, -60%) scale(0.9); opacity: 0; }
      to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    @keyframes slideOut {
      from { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      to { transform: translate(-50%, -60%) scale(0.9); opacity: 0; }
    }

    .form-container {
      transition: all 0.3s ease;
    }
    .form-container:hover {
      transform: scale(1.05);
    }
    .disabled-field {
      background-color: #f3f4f6;
      cursor: not-allowed;
    }
  </style>
</head>
<body class="min-h-screen bg-[#edf2f7] flex items-center justify-center p-4">
<div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md form-container">
  <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Forgot Password</h2>

  <form id="forgotPasswordForm" class="space-y-4">
    <input type="hidden" id="email" name="email" value="{{ email | default('') }}">
    <div>
      <label class="block text-sm font-medium text-gray-700">New Password</label>
      <input
              type="password"
              id="newPassword"
              name="newPassword"
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500"
              placeholder="********"
      />
      <p id="newPasswordError" class="text-red-500 text-sm mt-1 hidden"></p>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Retype New Password</label>
      <input
              type="password"
              id="retypePassword"
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500"
              placeholder="********"
      />
      <p id="retypePasswordError" class="text-red-500 text-sm mt-1 hidden"></p>
    </div>
    <button
            type="submit"
            id="resetPasswordButton"
            class="w-full bg-teal-600 text-white py-2 px-4 rounded-md hover:bg-teal-700 transition duration-300"
    >
      Reset Password
    </button>
  </form>



  <div id="notification" class="notification hidden"></div>
</div>
<script src="/static/js/notification.js"></script>
<script>
  const forgotPasswordForm = document.getElementById('forgotPasswordForm');
  const newPassword = document.getElementById('newPassword');
  const retypePassword = document.getElementById('retypePassword');
  const resetPasswordButton = document.getElementById('resetPasswordButton');
  const backToSignIn = document.getElementById('backToSignIn');
  const newPasswordError = document.getElementById('newPasswordError');
  const retypePasswordError = document.getElementById('retypePasswordError');
  const notification = document.getElementById('notification');

  let forgotData = { newPassword: '', retypePassword: '' };

  function resetPasswordFields() {
    newPassword.value = '';
    retypePassword.value = '';
    forgotData.newPassword = '';
    forgotData.retypePassword = '';
    newPasswordError.classList.add('hidden');
    retypePasswordError.classList.add('hidden');
  }


  forgotPasswordForm.addEventListener('input', (e) => {
    const { id, value } = e.target;
    forgotData[id] = value;

    if (id === 'newPassword') {
      if (value.length < 8) {
        newPasswordError.textContent = 'New password must be at least 8 characters';
        newPasswordError.classList.remove('hidden');
        newPasswordError.classList.add('error-animate');
        setTimeout(() => newPasswordError.classList.remove('error-animate'), 500);
      } else {
        newPasswordError.classList.add('hidden');
      }
    }
    if (id === 'retypePassword') {
      if (value !== forgotData.newPassword) {
        retypePasswordError.textContent = 'Passwords do not match';
        retypePasswordError.classList.remove('hidden');
        retypePasswordError.classList.add('error-animate');
        setTimeout(() => retypePasswordError.classList.remove('error-animate'), 500);
      } else {
        retypePasswordError.classList.add('hidden');
      }
    }
  });

  forgotPasswordForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (newPasswordError.classList.contains('hidden') === false || retypePasswordError.classList.contains('hidden') === false) {
      alert('Please correct the errors before resetting.');
      return;
    }

    try {
      const response = await fetch('/forgot-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({
          email: document.getElementById('email').value,
          newPassword: forgotData.newPassword
        }).toString()
      });
      const result = await response.json();
      if (result.error) {
        alert(result.error);
      } else {
        alert('Password reset successful! You can close this window if you want...');
        resetPasswordFields();
      }
    } catch (error) {
      console.error('Error:', error);
      alert('An error occurred during password reset.');
    }
  });

  backToSignIn.addEventListener('click', () => {
    window.location.href = "/signin";
  });
</script>
</body>
</html>